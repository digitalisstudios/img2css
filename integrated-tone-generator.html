<!DOCTYPE html>
<html>
<head>
    <title>Integrated Tone Mask Generator - img2css v2.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #222;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .approach-explanation {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #4CAF50;
            margin-bottom: 30px;
        }
        
        .approach-explanation h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        
        .controls {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #555;
            margin-bottom: 20px;
        }
        
        .control-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 14px;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .control-group span {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .file-input {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 10px;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .generate-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .generate-btn:hover {
            background: #45a049;
        }
        
        .progress-bar {
            background: #444;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            display: none;
        }
        
        .progress-fill {
            background: #4CAF50;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-container {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #555;
        }
        
        .result-container h3 {
            color: #4CAF50;
            margin-top: 0;
            text-align: center;
        }
        
        .blend-demo {
            width: 100%;
            height: 300px;
            position: relative;
            border: 2px solid #666;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto;
            background: #000;
        }
        
        .layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .layer-base {
            background: var(--generated-gradient, #999);
        }
        
        .layer-specular-integrated {
            background: var(--specular-gradient, transparent);
            mix-blend-mode: color-dodge;
            -webkit-mask: var(--specular-mask, none);
            mask: var(--specular-mask, none);
            pointer-events: none;
        }
        
        .layer-reflection-integrated {
            background: var(--reflection-gradient, transparent);
            mix-blend-mode: soft-light;
            -webkit-mask: var(--reflection-mask, none);
            mask: var(--reflection-mask, none);
            pointer-events: none;
        }
        
        .layer-shadow-integrated {
            background: var(--shadow-gradient, transparent);
            mix-blend-mode: multiply;
            -webkit-mask: var(--shadow-mask, none);
            mask: var(--shadow-mask, none);
            pointer-events: none;
        }
        
        .layer-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .layer-toggle {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .layer-toggle.disabled {
            background: #666;
        }
        
        .layer-toggle:hover:not(.disabled) {
            background: #45a049;
        }
        
        .masks-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .mask-preview {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .mask-preview h4 {
            color: #4CAF50;
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        
        .mask-canvas {
            width: 100%;
            max-width: 200px;
            border: 1px solid #666;
            border-radius: 4px;
        }
        
        .stats {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #555;
            margin-bottom: 20px;
        }
        
        .stats h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-family: monospace;
            font-size: 14px;
        }
        
        .css-output {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #555;
        }
        
        .css-output h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        
        .css-code {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #444;
        }
        
        .copy-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .copy-btn:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Integrated Tone Mask Generator</h1>
        <p style="text-align: center; color: #ccc; margin-bottom: 30px;">
            Generate img2css gradients + tone masks simultaneously for perfect alignment
        </p>
        
        <div class="approach-explanation">
            <h3>üí° Integrated Processing Approach</h3>
            <p><strong>Single-pass processing:</strong> Generate base gradient AND tone masks from the same column/row analysis</p>
            <ul>
                <li><strong>Perfect alignment:</strong> Masks generated from exact same sampling points as gradient</li>
                <li><strong>Efficient data:</strong> B&W masks are highly compressible (~5-10KB each vs 700KB gradient)</li>
                <li><strong>Column-by-column:</strong> Build masks while iterating through image columns</li>
                <li><strong>Tone classification:</strong> Bright/mid/dark analysis during gradient generation</li>
            </ul>
        </div>
        
        <div class="controls">
            <h3>üéõÔ∏è Processing Controls</h3>
            
            <div class="control-row">
                <div class="control-group">
                    <label>Details Level: <span id="detailsValue">80</span>%</label>
                    <input type="range" id="details" min="20" max="100" step="5" value="80" onchange="updateControls()">
                </div>
                
                <div class="control-group">
                    <label>Specular Threshold: <span id="specularThresholdValue">200</span></label>
                    <input type="range" id="specularThreshold" min="180" max="255" step="5" value="200" onchange="updateControls()">
                </div>
                
                <div class="control-group">
                    <label>Shadow Threshold: <span id="shadowThresholdValue">80</span></label>
                    <input type="range" id="shadowThreshold" min="30" max="120" step="5" value="80" onchange="updateControls()">
                </div>
            </div>
            
            <input type="file" id="imageInput" class="file-input" accept="image/*">
            
            <button id="generateBtn" class="generate-btn" onclick="generateIntegratedOutput()">
                üöÄ Generate Gradient + Tone Masks
            </button>
            
            <div id="progressBar" class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="progressText" style="text-align: center; color: #ccc; font-size: 14px; display: none;"></div>
        </div>
        
        <div class="results-grid">
            <div class="result-container">
                <h3>üé® Generated Gradient (Base)</h3>
                <div class="blend-demo">
                    <div class="layer layer-base" id="layerBase"></div>
                </div>
                <p style="text-align: center; color: #999; font-size: 12px; margin-top: 10px;">
                    img2css-style gradient generated from column analysis
                </p>
            </div>
            
            <div class="result-container">
                <h3>‚ú® Enhanced with Tone Masks</h3>
                <div class="blend-demo" id="enhancedDemo">
                    <div class="layer layer-base" id="layerBaseEnhanced"></div>
                    <div class="layer layer-specular-integrated" id="layerSpecularIntegrated"></div>
                    <div class="layer layer-reflection-integrated" id="layerReflectionIntegrated"></div>
                    <div class="layer layer-shadow-integrated" id="layerShadowIntegrated"></div>
                </div>
                
                <div class="layer-controls">
                    <button class="layer-toggle" onclick="toggleLayer('layerBaseEnhanced')">Base</button>
                    <button class="layer-toggle" onclick="toggleLayer('layerSpecularIntegrated')">Specular</button>
                    <button class="layer-toggle" onclick="toggleLayer('layerReflectionIntegrated')">Reflection</button>
                    <button class="layer-toggle" onclick="toggleLayer('layerShadowIntegrated')">Shadow</button>
                </div>
                
                <div class="masks-preview">
                    <div class="mask-preview">
                        <h4>Specular Mask</h4>
                        <canvas id="specularMaskCanvas" class="mask-canvas"></canvas>
                    </div>
                    <div class="mask-preview">
                        <h4>Reflection Mask</h4>
                        <canvas id="reflectionMaskCanvas" class="mask-canvas"></canvas>
                    </div>
                    <div class="mask-preview">
                        <h4>Shadow Mask</h4>
                        <canvas id="shadowMaskCanvas" class="mask-canvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <h3>üìä Generation Statistics</h3>
            <div id="statsContent">
                Generate gradient + masks to see processing statistics
            </div>
        </div>
        
        <div class="css-output">
            <h3>üìÑ Complete CSS Output</h3>
            <div id="cssCode" class="css-code">
                /* Generate gradient + tone masks to see the complete CSS output */
            </div>
            <button class="copy-btn" onclick="copyCSSCode()">üìã Copy Complete CSS</button>
        </div>
    </div>

    <script>
        let originalImageData = null;
        let generatedGradient = null;
        let toneMasks = null;
        let processingStats = null;
        
        function updateControls() {
            document.getElementById('detailsValue').textContent = document.getElementById('details').value;
            document.getElementById('specularThresholdValue').textContent = document.getElementById('specularThreshold').value;
            document.getElementById('shadowThresholdValue').textContent = document.getElementById('shadowThreshold').value;
        }
        
        // Handle file input
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                loadImageFile(file);
            }
        });
        
        function loadImageFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    processImage(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function processImage(img) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (maintain aspect ratio)
            const maxWidth = 800;
            const maxHeight = 600;
            let { width, height } = img;
            
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            ctx.drawImage(img, 0, 0, width, height);
            originalImageData = ctx.getImageData(0, 0, width, height);
            
            document.getElementById('generateBtn').disabled = false;
            console.log(`Image loaded: ${width}x${height}`);
        }
        
        async function generateIntegratedOutput() {
            if (!originalImageData) {
                alert('Please load an image first!');
                return;
            }
            
            showProgress(true);
            updateProgress(10, 'Starting integrated processing...');
            
            try {
                // Process image with integrated gradient + mask generation
                const result = await processImageIntegrated(originalImageData);
                
                updateProgress(70, 'Applying results...');
                
                // Apply results to preview
                applyGeneratedGradient(result.gradient);
                applyIntegratedMasks(result.masks);
                
                updateProgress(90, 'Generating CSS...');
                
                // Generate CSS output
                const cssCode = generateIntegratedCSS(result);
                displayCSSCode(cssCode);
                
                // Update stats
                displayStats(result.stats);
                
                updateProgress(100, 'Complete!');
                await sleep(500);
                showProgress(false);
                
                console.log('Integrated processing complete!');
                
            } catch (error) {
                console.error('Error during processing:', error);
                showProgress(false);
            }
        }
        
        async function processImageIntegrated(imageData) {
            const data = imageData.data;
            const width = imageData.width;
            const height = imageData.height;
            
            const detailsLevel = parseInt(document.getElementById('details').value);
            const specularThreshold = parseInt(document.getElementById('specularThreshold').value);
            const shadowThreshold = parseInt(document.getElementById('shadowThreshold').value);
            
            // Calculate column step based on details level
            const columnStep = Math.max(1, Math.floor((100 - detailsLevel) / 10));
            const totalColumns = Math.floor(width / columnStep);
            
            let gradientStops = [];
            let specularData = new Uint8ClampedArray(width * height * 4);
            let reflectionData = new Uint8ClampedArray(width * height * 4);
            let shadowData = new Uint8ClampedArray(width * height * 4);
            
            let processedColumns = 0;
            let specularPixels = 0;
            let reflectionPixels = 0;
            let shadowPixels = 0;
            
            // Process columns (img2css style)
            for (let x = 0; x < width; x += columnStep) {
                const columnColors = [];
                const columnMaskData = { specular: [], reflection: [], shadow: [] };
                
                // Sample column (like img2css does)
                for (let y = 0; y < height; y++) {
                    const index = (y * width + x) * 4;
                    const r = data[index];
                    const g = data[index + 1];
                    const b = data[index + 2];
                    const a = data[index + 3];
                    
                    if (a === 0) continue;
                    
                    // Convert to grayscale for tone analysis
                    const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                    
                    // Add to gradient
                    columnColors.push({ r, g, b, position: (y / height) * 100 });
                    
                    // Classify tone and add to appropriate mask
                    const maskValue = 255;
                    const xStart = x;
                    const xEnd = Math.min(x + columnStep, width);
                    
                    for (let maskX = xStart; maskX < xEnd; maskX++) {
                        const maskIndex = (y * width + maskX) * 4;
                        
                        if (gray >= specularThreshold) {
                            // Specular highlight
                            specularData[maskIndex] = maskValue;
                            specularData[maskIndex + 1] = maskValue;
                            specularData[maskIndex + 2] = maskValue;
                            specularData[maskIndex + 3] = maskValue;
                            specularPixels++;
                        } else if (gray <= shadowThreshold) {
                            // Shadow
                            shadowData[maskIndex] = maskValue;
                            shadowData[maskIndex + 1] = maskValue;
                            shadowData[maskIndex + 2] = maskValue;
                            shadowData[maskIndex + 3] = maskValue;
                            shadowPixels++;
                        } else {
                            // Reflection (mid-tone)
                            reflectionData[maskIndex] = maskValue;
                            reflectionData[maskIndex + 1] = maskValue;
                            reflectionData[maskIndex + 2] = maskValue;
                            reflectionData[maskIndex + 3] = maskValue;
                            reflectionPixels++;
                        }
                    }
                }
                
                // Generate gradient stop for this column
                if (columnColors.length > 0) {
                    const avgColor = averageColors(columnColors);
                    const xPercent = (x / width) * 100;
                    gradientStops.push(`rgb(${avgColor.r}, ${avgColor.g}, ${avgColor.b}) ${xPercent.toFixed(2)}%`);
                }
                
                processedColumns++;
                
                // Update progress
                const progress = 20 + (processedColumns / totalColumns) * 50;
                updateProgress(progress, `Processing column ${processedColumns}/${totalColumns}...`);
                await sleep(1);
            }
            
            // Create final gradient
            const finalGradient = `linear-gradient(to right, ${gradientStops.join(', ')})`;
            
            // Create mask ImageData objects
            const masks = {
                specular: new ImageData(specularData, width, height),
                reflection: new ImageData(reflectionData, width, height),
                shadow: new ImageData(shadowData, width, height)
            };
            
            const stats = {
                imageSize: `${width}x${height}`,
                columnsProcessed: processedColumns,
                gradientStops: gradientStops.length,
                specularPixels,
                reflectionPixels,
                shadowPixels,
                totalPixels: width * height,
                specularPercentage: ((specularPixels / (width * height)) * 100).toFixed(2),
                reflectionPercentage: ((reflectionPixels / (width * height)) * 100).toFixed(2),
                shadowPercentage: ((shadowPixels / (width * height)) * 100).toFixed(2)
            };
            
            return {
                gradient: finalGradient,
                masks: masks,
                stats: stats
            };
        }
        
        function averageColors(colors) {
            const total = colors.reduce((acc, color) => {
                acc.r += color.r;
                acc.g += color.g;
                acc.b += color.b;
                return acc;
            }, { r: 0, g: 0, b: 0 });
            
            const count = colors.length;
            return {
                r: Math.round(total.r / count),
                g: Math.round(total.g / count),
                b: Math.round(total.b / count)
            };
        }
        
        function applyGeneratedGradient(gradient) {
            document.getElementById('layerBase').style.background = gradient;
            document.getElementById('layerBaseEnhanced').style.background = gradient;
            generatedGradient = gradient;
        }
        
        function applyIntegratedMasks(masks) {
            const demo = document.getElementById('enhancedDemo');
            
            // Convert masks to data URLs
            const specularMaskUrl = maskToDataURL(masks.specular);
            const reflectionMaskUrl = maskToDataURL(masks.reflection);
            const shadowMaskUrl = maskToDataURL(masks.shadow);
            
            // Display mask previews
            displayMaskPreview('specularMaskCanvas', masks.specular);
            displayMaskPreview('reflectionMaskCanvas', masks.reflection);
            displayMaskPreview('shadowMaskCanvas', masks.shadow);
            
            // Define enhancement gradients
            const specularGradient = 'radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.4) 60%, transparent 100%)';
            const reflectionGradient = 'linear-gradient(135deg, rgba(200,220,255,0.3) 0%, rgba(255,255,255,0.15) 50%, rgba(180,200,255,0.25) 100%)';
            const shadowGradient = 'linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.5) 100%)';
            
            // Apply to CSS
            demo.style.setProperty('--specular-gradient', specularGradient);
            demo.style.setProperty('--specular-mask', `url("${specularMaskUrl}")`);
            
            demo.style.setProperty('--reflection-gradient', reflectionGradient);
            demo.style.setProperty('--reflection-mask', `url("${reflectionMaskUrl}")`);
            
            demo.style.setProperty('--shadow-gradient', shadowGradient);
            demo.style.setProperty('--shadow-mask', `url("${shadowMaskUrl}")`);
            
            toneMasks = {
                specularUrl: specularMaskUrl,
                reflectionUrl: reflectionMaskUrl,
                shadowUrl: shadowMaskUrl
            };
        }
        
        function maskToDataURL(imageData) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = imageData.width;
            canvas.height = imageData.height;
            ctx.putImageData(imageData, 0, 0);
            return canvas.toDataURL();
        }
        
        function displayMaskPreview(canvasId, imageData) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Scale down for preview
            const scale = Math.min(200 / imageData.width, 150 / imageData.height);
            canvas.width = imageData.width * scale;
            canvas.height = imageData.height * scale;
            
            // Create temporary canvas at full size
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = imageData.width;
            tempCanvas.height = imageData.height;
            tempCtx.putImageData(imageData, 0, 0);
            
            // Draw scaled down
            ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
        }
        
        function displayStats(stats) {
            const statsHtml = `
                <div class="stat-item"><span>Image Size:</span><span>${stats.imageSize}</span></div>
                <div class="stat-item"><span>Columns Processed:</span><span>${stats.columnsProcessed}</span></div>
                <div class="stat-item"><span>Gradient Stops:</span><span>${stats.gradientStops}</span></div>
                <div class="stat-item"><span>Specular Pixels:</span><span>${stats.specularPixels.toLocaleString()} (${stats.specularPercentage}%)</span></div>
                <div class="stat-item"><span>Reflection Pixels:</span><span>${stats.reflectionPixels.toLocaleString()} (${stats.reflectionPercentage}%)</span></div>
                <div class="stat-item"><span>Shadow Pixels:</span><span>${stats.shadowPixels.toLocaleString()} (${stats.shadowPercentage}%)</span></div>
                <div class="stat-item"><span>Total Pixels:</span><span>${stats.totalPixels.toLocaleString()}</span></div>
            `;
            document.getElementById('statsContent').innerHTML = statsHtml;
            processingStats = stats;
        }
        
        function generateIntegratedCSS(result) {
            return `/* img2css v2.0 - Integrated Gradient + Tone Masks */

/* Generated from ${result.stats.imageSize} image */
/* Processed ${result.stats.columnsProcessed} columns with ${result.stats.gradientStops} gradient stops */

.img2css-v2-container {
    position: relative;
    width: 100%;
    height: auto;
    aspect-ratio: ${originalImageData.width} / ${originalImageData.height};
}

/* Base Layer: Generated img2css-style gradient */
.img2css-v2-base {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: ${result.gradient};
}

/* Specular Layer: Bright highlights (${result.stats.specularPercentage}% of image) */
.img2css-v2-specular {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.4) 60%, transparent 100%);
    mix-blend-mode: color-dodge;
    mask: url("${toneMasks?.specularUrl || 'data:image/png;base64,'}");
    -webkit-mask: url("${toneMasks?.specularUrl || 'data:image/png;base64,'}");
    pointer-events: none;
}

/* Reflection Layer: Mid-tones (${result.stats.reflectionPercentage}% of image) */
.img2css-v2-reflection {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(200,220,255,0.3) 0%, rgba(255,255,255,0.15) 50%, rgba(180,200,255,0.25) 100%);
    mix-blend-mode: soft-light;
    mask: url("${toneMasks?.reflectionUrl || 'data:image/png;base64,'}");
    -webkit-mask: url("${toneMasks?.reflectionUrl || 'data:image/png;base64,'}");
    pointer-events: none;
}

/* Shadow Layer: Dark areas (${result.stats.shadowPercentage}% of image) */
.img2css-v2-shadow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.5) 100%);
    mix-blend-mode: multiply;
    mask: url("${toneMasks?.shadowUrl || 'data:image/png;base64,'}");
    -webkit-mask: url("${toneMasks?.shadowUrl || 'data:image/png;base64,'}");
    pointer-events: none;
}

/* HTML Structure:
<div class="img2css-v2-container">
    <div class="img2css-v2-base"></div>
    <div class="img2css-v2-specular"></div>
    <div class="img2css-v2-reflection"></div>
    <div class="img2css-v2-shadow"></div>
</div>

File Size Estimates:
- Base gradient: ~${Math.round(result.gradient.length / 1024)}KB
- Specular mask: ~${Math.round((toneMasks?.specularUrl?.length || 0) / 1024)}KB (B&W, highly compressible)
- Reflection mask: ~${Math.round((toneMasks?.reflectionUrl?.length || 0) / 1024)}KB (B&W, highly compressible)  
- Shadow mask: ~${Math.round((toneMasks?.shadowUrl?.length || 0) / 1024)}KB (B&W, highly compressible)
Total: Much smaller than equivalent complex gradient!
*/`;
        }
        
        function displayCSSCode(cssCode) {
            document.getElementById('cssCode').textContent = cssCode;
        }
        
        function copyCSSCode() {
            const cssCode = document.getElementById('cssCode').textContent;
            navigator.clipboard.writeText(cssCode).then(() => {
                console.log('Integrated CSS code copied to clipboard!');
            });
        }
        
        function toggleLayer(layerId) {
            const layer = document.getElementById(layerId);
            const button = event.target;
            
            if (layer.style.display === 'none') {
                layer.style.display = 'block';
                button.classList.remove('disabled');
            } else {
                layer.style.display = 'none';
                button.classList.add('disabled');
            }
        }
        
        function showProgress(show) {
            document.getElementById('progressBar').style.display = show ? 'block' : 'none';
            document.getElementById('progressText').style.display = show ? 'block' : 'none';
            document.getElementById('generateBtn').disabled = show;
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>